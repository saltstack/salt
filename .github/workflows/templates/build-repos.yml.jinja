<%- for platform, type, display_name, needs_pkg in (
                                                    (None, "src", "Source", False),
                                                    ("linux", "deb", "DEB", True),
                                                    ("linux", "rpm", "RPM", True),
                                                    ("windows", "windows", "Windows", True),
                                                    ("macos", "macos", "macOS", True),
                                                    (None, "onedir", "Onedir", False),
                                                  ) %>

  <%- set job_name = "build-{}-repo".format(type) %>
    <%- do build_repo_needs.append(job_name) %>

  <{ job_name }>:
    name: Build <{ display_name }> Repository
    environment: <{ gh_environment }>
    runs-on:
      - self-hosted
      - linux
      - repo-<{ gh_environment }>
    needs:
      - prepare-workflow
      <%- if needs_pkg %>
      - build-<{ type }>-pkgs-onedir
      <%- elif platform %>
      - build-salt-onedir-<{ platform }>
      <%- endif %>
    <%- include "build-{}-repo.yml.jinja".format(type) %>

<%- endfor %>
